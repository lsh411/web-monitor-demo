<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로컬 테스트 - 관리기록</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="config.js"></script>
  
  <!-- 로그인 상태 설정 -->
  <script>
    localStorage.setItem('isLoggedIn', 'true');
    localStorage.setItem('username', 'test_user');
    console.log('로그인 상태 설정 완료');
  </script>
</head>
<body>
  <div class="main-bg">
    <header class="main-header">
      <div class="logo-nav">
        <img src="assets/hello-on_logotype.png" alt="헬로온 로고" class="hello-logo" />
        <nav class="gnb">
          <button class="gnb-btn" data-page="dashboard.html" onclick="window.location.href='dashboard.html'"><span class="icon dashboard"></span>대시보드</button>
          <button class="gnb-btn active" data-page="record.html"><span class="icon record"></span>관리기록</button>
          <button class="gnb-btn" data-page="status.html"><span class="icon status"></span>전체상태</button>
          <button class="gnb-btn" data-page="guardian.html"><span class="icon guardian"></span>보호자</button>
          <button class="gnb-btn" data-page="disease.html"><span class="icon disease"></span>유병확률</button>
        </nav>
      </div>
      <div class="header-actions">
        <button class="alarm-btn"><span class="icon alarm"></span></button>
        <div class="user-menu">
          <span class="user-role">테스트 계정</span>
          <span class="user-name">test_user</span>
          <button class="logout-btn" onclick="logout()">로그아웃</button>
        </div>
      </div>
    </header>
    <main class="record-main" id="main-content">
      <section class="record-status-bar">
        <span class="record-title">관리기록 (로컬 테스트)</span>
        <span class="record-desc">실제 API 데이터 또는 목업 데이터로 테스트하는 페이지입니다.</span>
        <span class="record-date" id="current-date">로딩 중...</span>
      </section>
      <div class="record-workspace">
        <aside class="record-sidebar">
          <h3 class="sidebar-title"><span class="toggle-icon"></span>위험 신호 <span class="badge" id="total-badge">0</span></h3>
          <ul class="sidebar-menu">
            <li class="sidebar-item active" data-type="unconfirmed">미확인 위험 신호 <span class="sub-count">0</span></li>
            <li class="sidebar-item" data-type="confirmed">확인된 위험 신호 <span class="sub-count">0</span></li>
            <li class="sidebar-item" data-type="resolved">해결 완료된 신호 <span class="sub-count">0</span></li>
          </ul>

          <h3 class="sidebar-title disabled">수면시간 부족</h3>
          <h3 class="sidebar-title disabled">영양 부족</h3>
          <h3 class="sidebar-title disabled">운동 부족</h3>

          <div class="sidebar-separator"></div>

          <h3 class="sidebar-title disabled">입소인 기록</h3>
          <h3 class="sidebar-title disabled">기록 보관</h3>
        </aside>

        <div class="record-panel">
          <div class="record-list-detail">
            <section class="record-list-pane">
              <div class="record-list-box">
                <div class="record-list-header">
                  <input type="checkbox" id="select-all" class="select-all-checkbox" />
                  <div class="list-action-group">
                    <button id="bulk-action-btn" class="list-action-btn">
                      <span class="triangle-icon"></span>
                    </button>
                    <div id="bulk-action-menu" class="bulk-menu hidden">
                      <button data-action="select-all">전체 선택</button>
                      <button data-action="mark-read">읽음</button>
                      <button data-action="mark-unread">읽지않음</button>
                    </div>
                    <button id="refresh-btn" class="list-action-btn">
                      <span class="refresh-icon"></span>
                    </button>
                  </div>
                </div>

                <section class="record-list-body" id="record-list-body">
                  <div style="text-align: center; padding: 20px; color: #666;">
                    데이터를 불러오는 중...
                  </div>
                </section>
              </div>
            </section>

            <section class="record-detail-pane">
              <div class="record-detail-header">
                <button class="detail-back-btn"><</button>
                <span class="detail-time">시간 선택</span>
              </div>
              <h4 class="detail-title">기록을 선택하세요</h4>
              <div class="detail-body">기록을 클릭하면 상세 정보가 표시됩니다.</div>
            </section>
          </div>
        </div>
      </div>
    </main>
  </div>

<!-- Test Info Panel -->
<div style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 8px; max-width: 300px; font-size: 12px; z-index: 9999;">
  <h4 style="margin: 0 0 10px 0; color: #4CAF50;">🔧 개발 테스트 패널</h4>
  <div id="test-status">
    <div>API 설정: <span id="api-mode">확인 중...</span></div>
    <div>레코드 수: <span id="record-count">0</span></div>
    <div>마지막 업데이트: <span id="last-update">-</span></div>
  </div>
  <div style="margin-top: 10px;">
    <button onclick="toggleTestMode()" style="background: #2196F3; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">목업 데이터 토글</button>
    <button onclick="forceRefresh()" style="background: #FF9800; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">강제 새로고침</button>
    <button onclick="testDetailPane()" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">디테일 패널 테스트</button>
  </div>
</div>

<script>
  // 로그아웃 함수
  function logout() {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('username');
      window.location.href = 'index.html';
  }
  
  // Test panel functions
  function updateTestPanel() {
    const apiMode = window.API_CONFIG?.ENABLE_MOCK_DATA ? '🎭 목업 데이터' : '🌐 실제 API';
    document.getElementById('api-mode').textContent = apiMode;
    
    if (typeof recordData !== 'undefined') {
      const totalRecords = Object.values(recordData).reduce((sum, arr) => sum + arr.length, 0);
      const breakdown = `총 ${totalRecords}개 (미확인:${recordData.unconfirmed?.length || 0}, 확인:${recordData.confirmed?.length || 0}, 해결:${recordData.resolved?.length || 0})`;
      document.getElementById('record-count').textContent = breakdown;
    } else {
      document.getElementById('record-count').textContent = '로딩 중...';
    }
    
    document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
  }
  
  function toggleTestMode() {
    if (window.API_CONFIG) {
      const oldMode = window.API_CONFIG.ENABLE_MOCK_DATA;
      window.API_CONFIG.ENABLE_MOCK_DATA = !window.API_CONFIG.ENABLE_MOCK_DATA;
      const newMode = window.API_CONFIG.ENABLE_MOCK_DATA;
      
      console.log('🔄 모드 변경:', oldMode ? '목업' : '실제API', '→', newMode ? '목업' : '실제API');
      console.log('🎛️ 새 설정:', window.API_CONFIG);
      
      forceRefresh();
    }
  }
  
  function testDetailPane() {
    console.log('🧪 Testing detail pane functionality...');
    
    // Test buildDetailHTML function if available
    if (typeof buildDetailHTML === 'function') {
      const testRecord = {
        name: '김영수',
        img: 'assets/status_01.png',
        wardedUserId: 'ward001',
        detail: {
          msg: '테스트 메시지입니다.',
          caller: '김영수',
          location: '1층 거실',
          map: 'assets/map_101.png',
          vitals: [
            { label: '심박수', value: '72 bpm', time: '방금' },
            { label: '산소포화도', value: '98%', time: '1분전' }
          ]
        }
      };
      
      const htmlResult = buildDetailHTML(testRecord, true, false);
      console.log('🧪 Test buildDetailHTML result:', htmlResult);
      
      // Try to inject into detail pane
      const detailPane = document.querySelector('.record-detail-pane .detail-body');
      if (detailPane) {
        detailPane.innerHTML = htmlResult;
        console.log('✅ Injected test HTML into detail pane');
      } else {
        console.log('❌ Detail pane not found');
      }
    } else {
      console.log('❌ buildDetailHTML function not available');
    }
  }
  
  async function forceRefresh() {
    console.log('Force refreshing data...');
    if (typeof fetchRecordData === 'function') {
      await fetchRecordData();
      const activeType = document.querySelector('.sidebar-menu li.active')?.dataset.type || 'unconfirmed';
      if (typeof renderList === 'function') {
        renderList(activeType);
      }
      if (typeof syncSidebarCounts === 'function') {
        syncSidebarCounts();
      }
      updateTestPanel();
    }
  }
  
  // Update current date
  function updateCurrentDate() {
    const now = new Date();
    const dateStr = now.toLocaleDateString('ko-KR', {
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    });
    const timeStr = now.toLocaleTimeString('ko-KR');
    document.getElementById('current-date').textContent = `${dateStr} ${timeStr}`;
  }
  
  document.addEventListener("DOMContentLoaded", function() {
    console.log('테스트 페이지 로드 완료');
    updateCurrentDate();
    setInterval(updateCurrentDate, 1000);
    setInterval(updateTestPanel, 2000);
    
    // Check if everything loaded
    setTimeout(() => {
      updateTestPanel();
      if (typeof recordData !== 'undefined') {
        console.log('recordData available:', recordData);
      } else {
        console.warn('recordData not available');
      }
    }, 1000);
  });
</script>
<script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>í—¬ë¡œì˜¨ ê´€ë¦¬ê¸°ë¡</title>
  <link rel="stylesheet" href="style.css?v=1.0.0">
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="config.js?v=2.0.0"></script>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=76614caefbdbf2a0cc21c70f2f43abd9"></script>
  
  <!-- ë¡œê·¸ì¸ ì²´í¬ -->
  <script>
    // ë¡œê·¸ì¸ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    if (localStorage.getItem('isLoggedIn') !== 'true') {
      window.location.href = 'index.html';
    }
  </script>
</head>
<body>
  <div class="main-bg">
    <header class="main-header">
      <div class="logo-nav">
        <img src="assets/hello-on_logotype.png" alt="í—¬ë¡œì˜¨ ë¡œê³ " class="hello-logo" />
        <nav class="gnb">
          <button class="gnb-btn" data-page="dashboard.html" onclick="navigateTo('dashboard.html')"><span class="icon dashboard"></span>ëŒ€ì‹œë³´ë“œ</button>
          <button class="gnb-btn active" data-page="record.html"><span class="icon record"></span>ê´€ë¦¬ê¸°ë¡</button>
          <button class="gnb-btn" data-page="outing-report.html" onclick="navigateTo('outing-report.html')"><span class="icon record"></span>ì™¸ì¶œë¦¬í¬íŠ¸</button>
          <button class="gnb-btn" data-page="attendance-report.html" onclick="navigateTo('attendance-report.html')"><span class="icon record"></span>ì¶œí‡´ê·¼</button>
          <button class="gnb-btn" data-page="ai-report.html" onclick="navigateTo('ai-report.html')"><span class="icon record"></span>AIë¦¬í¬íŠ¸</button>
        </nav>
      </div>
      <div class="header-actions">
        <button class="settings-btn" title="ì¸ì› ê´€ë¦¬">
          <span class="icon settings"></span>
        </button>
        <!-- <button class="alarm-btn"><span class="icon alarm"></span></button> -->
        <div class="user-menu">
          <span class="user-name" id="user-display-name">admin</span>
          <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
    </header>
    <main class="record-main" id="main-content">
      <section class="record-status-bar">
        <span class="record-title">ê´€ë¦¬ê¸°ë¡</span>
        <span class="record-desc">ì…ì†Œì¸ì˜ ìƒíƒœ ë³€ê²½, ë‹´ë‹¹ì í˜¸ì¶œ ë“±ì˜ ê´€ë¦¬ ê¸°ë¡ì„ í™•ì¸í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</span>
        <span class="record-date">5ì›” 8ì¼ ëª©ìš”ì¼</span>
      </section>
      <div class="record-workspace">
        <aside class="record-sidebar">
          <h3 class="sidebar-title"><span class="toggle-icon"></span>ìœ„í—˜ ì‹ í˜¸</h3>
          <ul class="sidebar-menu">
            <li class="sidebar-item active" data-type="unconfirmed">ë¯¸í™•ì¸ ìœ„í—˜ ì‹ í˜¸ <span class="sub-count"></span></li>
            <li class="sidebar-item" data-type="confirmed">í™•ì¸ëœ ìœ„í—˜ ì‹ í˜¸ <span class="sub-count"></span></li>
            <li class="sidebar-item has-subtabs" data-type="resolved">
              <div class="sidebar-item-header">í•´ê²° ì™„ë£Œëœ ì‹ í˜¸ <span class="sub-count"></span></div>
              <ul class="sidebar-subtabs">
                <li class="subtab-item" data-subtype="resolved_action">ì¡°ì¹˜ì™„ë£Œ <span class="sub-count"></span></li>
                <li class="subtab-item" data-subtype="resolved_noissue">ì´ìŠˆì—†ìŒ <span class="sub-count"></span></li>
              </ul>
            </li>
          </ul>

        </aside>

        <div class="record-panel">

          <div class="record-list-detail">
            <section class="record-list-pane">
              <div class="record-list-box">
                <section class="record-list-body" id="record-list-body">
                  <!-- Dynamic rows injected by script.js -->
                </section>
              </div>
            </section>

            <section class="record-detail-pane">
              <div class="record-detail-header">
                <span class="detail-time"></span>
              </div>
              <h4 class="detail-title"></h4>
              <div class="detail-body"></div>
            </section>
          </div><!-- .record-list-detail -->
        </div><!-- .record-panel -->
      </div><!-- .record-workspace -->
    </main>
  </div>

<!-- Modals (copied from index.html for consistency, can be refactored later if needed) -->
<div id="inmate-modal" class="modal-overlay hidden">
  <div class="modal-content">
    <button id="inmate-modal-close" class="modal-close">âœ•</button>
    <h2 class="modal-title">ì…ì†Œ ì¸ì› ìƒì„¸</h2>
    <button class="modal-edit-btn" onclick="alert('í¸ì§‘ ê¸°ëŠ¥ì€ ì•„ì§ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')">í¸ì§‘</button>
    <div class="modal-table-wrapper">
      <table class="modal-table">
        <thead>
          <tr>
            <th>#</th>
            <th>í”„ë¡œí•„</th>
            <th>ì„±í•¨</th>
            <th>ë‚˜ì´</th>
            <th>í˜¸ì‹¤</th>
            <th>ì…ì†Œì¼</th>
            <th>íŠ¹ì´ì‚¬í•­</th>
            <th>ë³´í˜¸ì</th>
            <th>ì—°ë½ì²˜</th>
          </tr>
        </thead>
        <tbody id="inmate-modal-body"></tbody>
      </table>
    </div>
  </div>
</div>

<div id="vacancy-modal" class="modal-overlay hidden">
  <div class="modal-content">
    <button id="vacancy-modal-close" class="modal-close">âœ•</button>
    <h2 class="modal-title">ê³µì‹¤ ìƒì„¸</h2>
    <button class="modal-edit-btn" onclick="alert('í¸ì§‘ ê¸°ëŠ¥ì€ ì•„ì§ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')">í¸ì§‘</button>
    <div class="modal-table-wrapper">
      <table class="modal-table">
        <thead>
          <tr>
            <th>í˜¸ì‹¤</th>
            <th>ì¹¨ëŒ€ 1</th>
            <th>ì¹¨ëŒ€ 2</th>
            <th>ì¹¨ëŒ€ 3</th>
            <th>ì¹¨ëŒ€ 4</th>
            <th>ì¹¨ëŒ€ 5</th>
          </tr>
        </thead>
        <tbody id="vacancy-modal-body"></tbody>
      </table>
    </div>
  </div>
</div>

<div id="call-modal" class="modal-overlay hidden">
  <div class="modal-content">
    <button id="call-modal-close" class="modal-close">âœ•</button>
    <h2 class="modal-title">ë‹´ë‹¹ì í˜¸ì¶œ</h2>
    <p id="call-modal-message" class="call-message"></p>
    <button id="call-phone-btn" class="call-phone-btn">ê´€ë¦¬ì¸ì—ê²Œ ì „í™”í•˜ê¸°</button>
  </div>
</div>

<div id="location-modal" class="modal-overlay hidden">
  <div class="modal-content">
    <button id="location-modal-close" class="modal-close">âœ•</button>
    <h2 class="modal-title">ìœ„ì¹˜ ì •ë³´</h2>
    <div style="margin-bottom: 16px;">
      <h3 id="location-name" style="margin: 0 0 4px 0; font-size: 1.1rem; font-weight: 600;">ì£¼ì†Œ</h3>
      <p id="location-distance" style="margin: 0; color: #6B7280; font-size: 0.875rem;">ê±°ë¦¬ ì •ë³´</p>
    </div>
    <div id="map-container" style="width: 100%; height: 300px; border-radius: 8px; overflow: hidden;"></div>
  </div>
</div>

<!-- ì…ì†Œì ê´€ë¦¬ ëª¨ë‹¬ -->
<div id="resident-management-modal" class="modal-overlay hidden">
  <div class="modal-content resident-management-modal">
    <button class="modal-close" onclick="closeResidentManagementModal()">âœ•</button>
    <h2 class="modal-title">ì¸ì› ê´€ë¦¬</h2>

    <div class="rm-modal-tabs">
      <button class="rm-modal-tab active" onclick="switchResidentTab('list')">ì…ì†Œì ëª©ë¡</button>
      <button class="rm-modal-tab" onclick="switchResidentTab('register')">ì¸ì› ë“±ë¡</button>
      <button class="rm-modal-tab" onclick="switchResidentTab('device')">ì›Œì¹˜ ì—°ê²° ê´€ë¦¬</button>
    </div>

    <div class="rm-modal-body">
      <!-- ì…ì†Œì ëª©ë¡ íƒ­ -->
      <div id="rm-tab-list" class="rm-tab-content">
        <div class="rm-list-header">
          <div class="rm-list-count">
            ì´ <strong id="rm-total-count">26</strong>ëª… ë“±ë¡ |
            ì›Œì¹˜ ì—°ê²° <strong id="rm-connected-count">24</strong> |
            ë¯¸ì—°ê²° <strong id="rm-disconnected-count" style="color:#DC2626;">2</strong>
          </div>
          <div class="rm-list-actions">
            <button id="rm-toggle-deleted-btn" class="btn btn-outline btn-sm" onclick="toggleDeletedResidents()">ì‚­ì œëœ ì…ì†Œì ë³´ê¸°</button>
            <button class="btn btn-primary btn-sm" onclick="switchResidentTab('register')">+ ìƒˆ ì…ì†Œì ë“±ë¡</button>
          </div>
        </div>

        <table class="rm-data-table">
          <thead>
            <tr>
              <th>ì…ì†Œì</th>
              <th>ì„±ë³„</th>
              <th>ë‚˜ì´</th>
              <th>í˜¸ì‹¤</th>
              <th>ì›Œì¹˜ ì—°ê²°</th>
              <th>íŠ¹ì´ì‚¬í•­</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="rm-resident-list">
            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
          </tbody>
        </table>
      </div>

      <!-- ì¸ì› ë“±ë¡ íƒ­ -->
      <div id="rm-tab-register" class="rm-tab-content hidden">
        <div class="rm-form-section">
          <div class="rm-form-section-title">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</div>
          <div class="rm-form-grid">
            <div class="rm-form-group">
              <label class="rm-form-label">ì´ë¦„ <span class="required">*</span></label>
              <input type="text" class="rm-form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" id="rm-input-name">
            </div>
            <div class="rm-form-group">
              <label class="rm-form-label">ë‚˜ì´ <span class="required">*</span></label>
              <input type="number" class="rm-form-input" placeholder="ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" id="rm-input-age">
            </div>
            <div class="rm-form-group">
              <label class="rm-form-label">ì„±ë³„ <span class="required">*</span></label>
              <div class="rm-radio-group">
                <div class="rm-radio-item">
                  <input type="radio" id="rm-gender-male" name="rm-gender" value="male">
                  <label for="rm-gender-male">ë‚¨ì„±</label>
                </div>
                <div class="rm-radio-item">
                  <input type="radio" id="rm-gender-female" name="rm-gender" value="female">
                  <label for="rm-gender-female">ì—¬ì„±</label>
                </div>
              </div>
            </div>
            <div class="rm-form-group">
              <label class="rm-form-label">í˜¸ì‹¤</label>
              <input type="text" class="rm-form-input" placeholder="ì˜ˆ: 101í˜¸" id="rm-input-room">
            </div>
            <div class="rm-form-group full-width">
              <label class="rm-form-label">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
              <div class="rm-profile-selector">
                <div class="rm-profile-options">
                  <div class="rm-profile-option selected">ğŸ‘µ</div>
                  <div class="rm-profile-option">ğŸ‘´</div>
                  <div class="rm-profile-option">ğŸ‘©</div>
                  <div class="rm-profile-option">ğŸ‘¨</div>
                  <div class="rm-profile-option">ğŸ§“</div>
                  <div class="rm-profile-option">ğŸ‘©â€ğŸ¦³</div>
                  <div class="rm-profile-option">ğŸ‘¨â€ğŸ¦³</div>
                  <div class="rm-profile-option">ğŸ§‘â€ğŸ¦³</div>
                  <div class="rm-profile-option">ğŸ‘§</div>
                  <div class="rm-profile-option">ğŸ‘¦</div>
                  <div class="rm-profile-option">ğŸ§”</div>
                  <div class="rm-profile-option">ğŸ‘±â€â™€ï¸</div>
                  <div class="rm-profile-option">ğŸ‘±â€â™‚ï¸</div>
                  <div class="rm-profile-option">ğŸ§•</div>
                  <div class="rm-profile-option">ğŸ‘³â€â™€ï¸</div>
                  <div class="rm-profile-option">ğŸ‘³â€â™‚ï¸</div>
                  <div class="rm-profile-option">ğŸ§‘</div>
                  <div class="rm-profile-option">ğŸ‘¶</div>
                  <div class="rm-profile-option">ğŸ§’</div>
                  <div class="rm-profile-option rm-profile-upload-option" title="ì§ì ‘ ì—…ë¡œë“œ">+</div>
                </div>
              </div>
            </div>
            <div class="rm-form-group full-width">
              <label class="rm-form-label">ë°°ê²½ ìƒ‰ìƒ</label>
              <div class="rm-color-selector">
                <div class="rm-color-options">
                  <div class="rm-color-option selected" data-color="#E5E7EB" style="background: #E5E7EB;"></div>
                  <div class="rm-color-option" data-color="#FEE2E2" style="background: #FEE2E2;"></div>
                  <div class="rm-color-option" data-color="#FECACA" style="background: #FECACA;"></div>
                  <div class="rm-color-option" data-color="#FEF3C7" style="background: #FEF3C7;"></div>
                  <div class="rm-color-option" data-color="#FDE68A" style="background: #FDE68A;"></div>
                  <div class="rm-color-option" data-color="#D1FAE5" style="background: #D1FAE5;"></div>
                  <div class="rm-color-option" data-color="#A7F3D0" style="background: #A7F3D0;"></div>
                  <div class="rm-color-option" data-color="#DBEAFE" style="background: #DBEAFE;"></div>
                  <div class="rm-color-option" data-color="#BFDBFE" style="background: #BFDBFE;"></div>
                  <div class="rm-color-option" data-color="#E0E7FF" style="background: #E0E7FF;"></div>
                  <div class="rm-color-option" data-color="#C7D2FE" style="background: #C7D2FE;"></div>
                  <div class="rm-color-option" data-color="#FCE7F3" style="background: #FCE7F3;"></div>
                  <div class="rm-color-option" data-color="#FBCFE8" style="background: #FBCFE8;"></div>
                  <div class="rm-color-option" data-color="#F3E8FF" style="background: #F3E8FF;"></div>
                  <div class="rm-color-option" data-color="#DDD6FE" style="background: #DDD6FE;"></div>
                  <div class="rm-color-option" data-color="#CCFBF1" style="background: #CCFBF1;"></div>
                  <div class="rm-color-option" data-color="#99F6E4" style="background: #99F6E4;"></div>
                  <div class="rm-color-option" data-color="#FED7AA" style="background: #FED7AA;"></div>
                  <div class="rm-color-option" data-color="#FDBA74" style="background: #FDBA74;"></div>
                  <div class="rm-color-option" data-color="#F5F5F4" style="background: #F5F5F4;"></div>
                </div>
                <div class="rm-profile-preview">
                  <span style="font-size: 12px; color: #6B7280; margin-right: 12px;">ë¯¸ë¦¬ë³´ê¸°:</span>
                  <div class="rm-preview-avatar" id="rm-profile-preview">ğŸ‘µ</div>
                </div>
              </div>
            </div>
            <div class="rm-form-group full-width">
              <label class="rm-form-label">íŠ¹ì´ì‚¬í•­</label>
              <textarea class="rm-form-input rm-form-textarea" placeholder="ê±´ê°• ìƒíƒœ, ì£¼ì˜ì‚¬í•­ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”" id="rm-input-notes"></textarea>
            </div>
          </div>
        </div>

        <div class="rm-form-actions">
          <button class="btn btn-secondary" onclick="switchResidentTab('list')">ì·¨ì†Œ</button>
          <button class="btn btn-primary" onclick="registerResident()">ì…ì†Œì ë“±ë¡</button>
        </div>
      </div>

      <!-- ì›Œì¹˜ ì—°ê²° ê´€ë¦¬ íƒ­ -->
      <div id="rm-tab-device" class="rm-tab-content hidden">
        <div class="rm-watch-register-form">
          <div class="rm-form-section-title">â• ìƒˆ ì›Œì¹˜ ë“±ë¡</div>
          <div class="rm-watch-form-grid">
            <div class="rm-form-group">
              <label class="rm-form-label">ì›Œì¹˜ ID <span class="required">*</span></label>
              <input type="text" class="rm-form-input" placeholder="ì˜ˆ: GW-010" id="rm-watch-id">
            </div>
            <div class="rm-form-group">
              <label class="rm-form-label">ì›Œì¹˜ ì´ë¦„</label>
              <input type="text" class="rm-form-input" placeholder="Galaxy Watch 5" id="rm-watch-name">
            </div>
            <button class="btn btn-primary" onclick="registerWatch()">ë“±ë¡</button>
          </div>
        </div>

        <div class="rm-list-header">
          <div class="rm-list-count">
            ë“±ë¡ëœ ì›Œì¹˜ <strong id="rm-device-total">0</strong>ëŒ€ | ì—°ê²°ë¨ <strong id="rm-device-connected">0</strong>ëŒ€ | ë¯¸ì—°ê²° <strong id="rm-device-disconnected" style="color:#DC2626;">0</strong>ëŒ€
          </div>
        </div>

        <div class="rm-device-list" id="rm-device-list">
          <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ
  document.addEventListener('DOMContentLoaded', function() {
      const username = localStorage.getItem('username');
      const userDisplayElement = document.getElementById('user-display-name');
      if (username && userDisplayElement) {
          userDisplayElement.textContent = username;
      }
  });

  // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
  function logout() {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('username');
      localStorage.removeItem('userType');
      localStorage.removeItem('watcherUserId');
      window.location.href = 'index.html';
  }
  
  // ë°ëª¨ ëª¨ë“œë¥¼ ìœ ì§€í•˜ë©´ì„œ í˜ì´ì§€ ì´ë™
  function navigateTo(page) {
      const urlParams = new URLSearchParams(window.location.search);
      const isDemoMode = urlParams.get('demo') === 'true';

      // userTypeì— ë”°ë¼ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ë¶„ê¸°
      if (page === 'dashboard.html') {
          const userType = localStorage.getItem('userType');
          if (userType === 'silvercare') {
              page = 'dashboard-poc.html';
          } else if (userType === 'silvercare2') {
              page = 'dashboard-v2.html';
          }
      }

      if (isDemoMode) {
          window.location.href = page + '?demo=true';
      } else {
          window.location.href = page;
      }
  }
  
  document.addEventListener("DOMContentLoaded", function() {
    // Record initialization is handled in script.js
    console.log('Record page loaded');
  });
</script>

<!-- ë°ëª¨ ëª¨ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë¨¼ì € ë¡œë“œ (URLì— ?demo=trueê°€ ìˆì„ ë•Œë§Œ) -->
<script>
if (new URLSearchParams(window.location.search).get('demo') === 'true') {
    document.write('<script src="demo-controller.js?v=1.0.0"><\/script>');
}
</script>

<script src="script.js?v=2.0.0"></script>
</body>
</html>

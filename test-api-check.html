<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API í…ŒìŠ¤íŠ¸ - ì´ë²¤íŠ¸ í™•ì¸</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .test-panel { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .api-config { background: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
    .event-list { background: white; padding: 15px; border-radius: 5px; }
    .event-item { padding: 10px; border-bottom: 1px solid #eee; }
    .event-item.fall { background: #ffebee; }
    .success { color: green; }
    .error { color: red; }
    .warning { color: orange; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ğŸ§ª API ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸</h1>
  
  <div class="test-panel">
    <h2>API ì„¤ì •</h2>
    <div class="api-config">
      <p><strong>BASE_URL:</strong> <span id="base-url"></span></p>
      <p><strong>ì‹¤ì œ API:</strong> http://ec2-52-78-169-124.ap-northeast-2.compute.amazonaws.com:8080</p>
      <p><strong>WATCHER_USER_ID:</strong> <span id="watcher-id"></span></p>
      <p><strong>ëª©ì—… ëª¨ë“œ:</strong> <span id="mock-mode"></span></p>
    </div>
    
    <p class="warning">âš ï¸ í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤: <code>node proxy-server.js</code></p>
    
    <button onclick="testApiConnection()">API ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    <button onclick="fetchAndDisplayEvents()">ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°</button>
    <button onclick="toggleMockMode()">ëª©ì—… ëª¨ë“œ í† ê¸€</button>
  </div>
  
  <div class="test-panel">
    <h2>í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
    <div id="test-result"></div>
  </div>
  
  <div class="test-panel">
    <h2>ì´ë²¤íŠ¸ ëª©ë¡</h2>
    <div id="event-list" class="event-list">
      <p>ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
    </div>
  </div>

  <script>
    // API ì„¤ì • - í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš©
    window.API_CONFIG = {
      BASE_URL: 'http://localhost:3001', // í”„ë¡ì‹œ ì„œë²„ URL (í¬íŠ¸ 3001)
      WATCHER_USER_ID: '3743690826',
      ENABLE_MOCK_DATA: false
    };
    
    // í™”ë©´ì— ì„¤ì • í‘œì‹œ
    function updateConfigDisplay() {
      document.getElementById('base-url').textContent = window.API_CONFIG.BASE_URL;
      document.getElementById('watcher-id').textContent = window.API_CONFIG.WATCHER_USER_ID;
      document.getElementById('mock-mode').textContent = window.API_CONFIG.ENABLE_MOCK_DATA ? 'ğŸ­ ON' : 'ğŸŒ OFF';
    }
    
    // API ì—°ê²° í…ŒìŠ¤íŠ¸
    async function testApiConnection() {
      const resultDiv = document.getElementById('test-result');
      resultDiv.innerHTML = '<p>ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</p>';
      
      try {
        const url = `${window.API_CONFIG.BASE_URL}/watcher/mappings?watcherUserId=${window.API_CONFIG.WATCHER_USER_ID}`;
        console.log('Testing URL:', url);
        
        const response = await fetch(url, {
          headers: {'Content-Type': 'application/json'}
        });
        
        if (response.ok) {
          const data = await response.json();
          resultDiv.innerHTML = `
            <p class="success">âœ… API ì—°ê²° ì„±ê³µ!</p>
            <p>ì‘ë‹µ ì½”ë“œ: ${data.code}</p>
            <p>ë©”ì‹œì§€: ${data.message}</p>
            <p>ë§¤í•‘ ìˆ˜: ${data.response ? data.response.length : 0}ê°œ</p>
          `;
        } else {
          resultDiv.innerHTML = `<p class="error">âŒ API ì—°ê²° ì‹¤íŒ¨: HTTP ${response.status}</p>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <p class="error">âŒ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ${error.message}</p>
          <p class="warning">í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”!</p>
        `;
        console.error('Connection test error:', error);
      }
    }
    
    // ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    async function fetchAndDisplayEvents() {
      const listDiv = document.getElementById('event-list');
      listDiv.innerHTML = '<p>ì´ë²¤íŠ¸ ë¡œë”© ì¤‘...</p>';
      
      try {
        const url = `${window.API_CONFIG.BASE_URL}/watcher/event?watcherUserId=${window.API_CONFIG.WATCHER_USER_ID}`;
        console.log('Fetching events from:', url);
        
        const response = await fetch(url, {
          headers: {'Content-Type': 'application/json'}
        });
        
        if (response.ok) {
          const data = await response.json();
          console.log('Event data:', data);
          
          if (data.code === "1000" && data.response) {
            if (data.response.length === 0) {
              listDiv.innerHTML = '<p>í˜„ì¬ ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
              const eventItems = data.response.map(event => {
                const eventItem = document.createElement('div');
                eventItem.className = `event-item ${event.eventType === 'FALL_DETECTED' ? 'fall' : ''}`;
                eventItem.innerHTML = `
                  <p><strong>ì´ë²¤íŠ¸ íƒ€ì…:</strong> ${event.eventType} ${event.eventType === 'FALL_DETECTED' ? 'ğŸš¨ ë‚™ìƒ!' : ''}</p>
                  <p><strong>ì´ë²¤íŠ¸ ID:</strong> ${event.eventId}</p>
                  <p><strong>ì‹œê°„:</strong> ${new Date(event.registrationDateTime).toLocaleString('ko-KR')}</p>
                  <p><strong>ìƒíƒœ:</strong> ${event.status}</p>
                `;
                return eventItem;
              });
              listDiv.innerHTML = '';
              eventItems.forEach(item => listDiv.appendChild(item));
            }
          } else {
            listDiv.innerHTML = `<p class="error">API ì‘ë‹µ ì—ëŸ¬: ${data.message}</p>`;
          }
        } else {
          listDiv.innerHTML = `<p class="error">HTTP ${response.status} ì—ëŸ¬</p>`;
        }
      } catch (error) {
        listDiv.innerHTML = `
          <p class="error">ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ${error.message}</p>
          <p class="warning">í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”!</p>
        `;
        console.error('Event fetch error:', error);
      }
    }
    
    // ëª©ì—… ëª¨ë“œ í† ê¸€
    function toggleMockMode() {
      window.API_CONFIG.ENABLE_MOCK_DATA = !window.API_CONFIG.ENABLE_MOCK_DATA;
      updateConfigDisplay();
      
      if (window.API_CONFIG.ENABLE_MOCK_DATA) {
        const mockEventItem = document.createElement('div');
        mockEventItem.className = 'event-item fall';
        mockEventItem.innerHTML = `
          <p><strong>ì´ë²¤íŠ¸ íƒ€ì…:</strong> FALL_DETECTED ğŸš¨ ë‚™ìƒ! (ëª©ì—… ë°ì´í„°)</p>
          <p><strong>ì´ë²¤íŠ¸ ID:</strong> mock_event_001</p>
          <p><strong>ì‹œê°„:</strong> ${new Date().toLocaleString('ko-KR')}</p>
          <p><strong>ìƒíƒœ:</strong> UNCONFIRMED</p>
        `;
        document.getElementById('event-list').innerHTML = '';
        document.getElementById('event-list').appendChild(mockEventItem);
      }
    }
    
    // ì´ˆê¸°í™”
    updateConfigDisplay();
  </script>
</body>
</html> 